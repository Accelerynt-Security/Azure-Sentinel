{
    "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
    "handler": "Microsoft.Azure.CreateUIDef",
    "version": "0.1.2-preview",
    "parameters": {
        "config": {
            "isWizard": false,
            "basics": {
                "description": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Logos/Copilot.svg\" width=\"75px\" height=\"75px\">\n\n**Note:** Please refer to the following before installing the solution: \n\n• Review the solution [Release Notes](https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/Microsoft%20Copilot/ReleaseNotes.md)\n\n • There may be [known issues](https://aka.ms/sentinelsolutionsknownissues) pertaining to this Solution, please refer to them before installing.\n\nMicrosoft Copilot is an AI-powered assistant that enhances productivity and collaboration across Microsoft 365 applications. As organizations adopt Copilot to streamline workflows and improve user experiences, it's essential to monitor and secure these AI interactions to maintain data privacy and compliance.\n\nThe Microsoft Sentinel solution for Microsoft Copilot enables organizations to monitor and detect suspicious or malicious activities related to Copilot usage across their Microsoft 365 environment.\n\nThis solution collects activity logs from Copilot interactions across various Microsoft 365 applications including Teams, Outlook, Word, Excel, PowerPoint, and other integrated services. It analyzes these logs to detect potential security threats and suspicious activities such as: unauthorized access to sensitive data through Copilot queries, unusual data extraction patterns, anomalous user behavior with AI assistance, potential data exfiltration attempts, and compliance violations in AI-assisted content generation.\n\nThe solution provides comprehensive visibility into Copilot usage patterns, allowing security teams to investigate detected threats with full context including user details, accessed content, query patterns, and interaction timestamps. This enables organizations to maintain security and compliance while leveraging the benefits of AI-powered productivity tools.\n\n**Important**\n\n- Please review the solution [documentation](https://learn.microsoft.com/azure/sentinel/copilot-solution-overview) to learn more about deploying, configuring and using this solution.\n\n**Data Connectors:** 1, **Parsers:** 3, **Workbooks:** 1, **Analytic Rules:** 15, **Hunting Queries:** 5, **Watchlists:** 1, **Playbooks:** 4\n\n[Learn more about Microsoft Sentinel](https://aka.ms/azuresentinel) | [Learn more about Solutions](https://aka.ms/azuresentinelsolutionsdoc)",
                "subscription": {
                    "resourceProviders": [
                        "Microsoft.OperationsManagement/solutions",
                        "Microsoft.OperationalInsights/workspaces/providers/alertRules",
                        "Microsoft.Insights/workbooks",
                        "Microsoft.Logic/workflows"
                    ]
                },
                "location": {
                    "metadata": {
                        "hidden": "Hiding location, we get it from the log analytics workspace"
                    },
                    "visible": false
                },
                "resourceGroup": {
                    "allowExisting": true
                }
            }
        },
        "basics": [
            {
                "name": "getLAWorkspace",
                "type": "Microsoft.Solutions.ArmApiControl",
                "toolTip": "This filters by workspaces that exist in the Resource Group selected",
                "condition": "[greater(length(resourceGroup().name),0)]",
                "request": {
                    "method": "GET",
                    "path": "[concat(subscription().id,'/providers/Microsoft.OperationalInsights/workspaces?api-version=2020-08-01')]"
                }
            },
            {
                "name": "workspace",
                "type": "Microsoft.Common.DropDown",
                "label": "Workspace",
                "placeholder": "Select a workspace",
                "toolTip": "This dropdown will list only workspace that exists in the Resource Group selected",
                "constraints": {
                    "allowedValues": "[map(filter(basics('getLAWorkspace').value, (filter) => contains(toLower(filter.id), toLower(resourceGroup().name))), (item) => parse(concat('{\"label\":\"', item.name, '\",\"value\":\"', item.name, '\"}')))]",
                    "required": true
                },
                "visible": true
            }
        ],
        "steps": [
            {
                "name": "dataconnectors",
                "label": "Data Connectors",
                "bladeTitle": "Data Connectors",
                "elements": [
                    {
                        "name": "dataconnectors1-text",
                        "type": "Microsoft.Common.TextBlock",
                        "options": {
                            "text": "This Solution installs the data connector for Microsoft Copilot. You can get Microsoft Copilot data in your Microsoft Sentinel workspace. After installing the solution, configure and enable this data connector by following guidance in Manage solution view."
                        }
                    },
                    {
                        "name": "dataconnectors-link2",
                        "type": "Microsoft.Common.TextBlock",
                        "options": {
                            "link": {
                                "label": "Learn more about connecting data sources",
                                "uri": "https://docs.microsoft.com/azure/sentinel/connect-data-sources"
                            }
                        }
                    }
                ]
            }
        ],
        "outputs": {
            "workspace-location": "[first(map(filter(basics('getLAWorkspace').value, (filter) => and(contains(toLower(filter.id), toLower(resourceGroup().name)),equals(filter.name,basics('workspace')))), (item) => item.location))]",
            "location": "[location()]",
            "workspace": "[basics('workspace')]"
        }
    }
}