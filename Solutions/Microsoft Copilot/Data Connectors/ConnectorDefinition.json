{
    "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
    "apiVersion": "2022-09-01-preview",
    "name": "MicrosoftCopilot",
    "location": "{{location}}",
    "kind": "Customizable",
    "properties": {
        "connectorUiConfig": {
            "id": "MicrosoftCopilot",
            "title": "Microsoft Copilot",
            "publisher": "Microsoft",
            "logo": "Copilot.svg",
            "descriptionMarkdown": "Microsoft Copilot brings AI-powered assistance across Microsoft 365 experiences. This connector streams Microsoft Copilot usage and activity telemetry into Microsoft Sentinel for security monitoring, investigation, and analytics. The ingested events are currently stored in the LLMActivity table.",
            "graphQueries": [
                {
                    "metricName": "Total data received",
                    "legend": "Microsoft Copilot",
                    "baseQuery": "LLMActivity"
                }
            ],
            "sampleQueries": [
                {
                    "description": "Microsoft Copilot Logs",
                    "query": "LLMActivity\n            | sort by TimeGenerated"
                }
            ],
            "connectivityCriteria": [
                {
                "type": "HasDataConnectors"
                }
            ],
            "dataTypes": [
                {
                    "name": "LLMActivity",
                    "lastDataReceivedQuery": "LLMActivity\n            | summarize Time = max(TimeGenerated)\n            | where isnotempty(Time)"
                }
            ],
            "availability": {
                "status": 1,
                "isPreview": true
            },
            "permissions": {
                "resourceProvider": [
                    {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "read and write permissions.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                            "read": true,
                            "write": true,
                            "delete": true
                        }
                    }
                ],
                "tenant": [
                    "GlobalAdmin",
                    "SecurityAdmin"
                ],
                "customs": [
                    {
                        "name": "License",
                        "description": "\"Microsoft Copilot eligible license is required.\""
                    }
                ]
            },
            "instructionSteps": [
                {
                    "title": "Connect Microsoft Copilot audit logs to Microsoft Sentinel",
                    "description": "Select the record types you want to collect from your tenant and click **Apply Changes**.",
                    "instructions": [
                        {
                            "type": "ConnectionToggleButton",
                            "parameters": {
                                "connectLabel": "toggle",
                                "name": "toggle"
                            }
                        }
                    ]
                }
            ]
        }
    }
}