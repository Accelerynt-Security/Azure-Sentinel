id: e4828d99-bb06-40b3-8f9d-0f68fb61e9ee
name: License Grace Period Started
description: Detects when Veeam enters license grace period, indicating potential
  licensing issues that need attention.
severity: High
status: Available
requiredDataConnectors:
  - connectorId: Syslog
    dataTypes: 
      - Syslog
  - connectorId: SyslogAma
    dataTypes: 
      - Syslog
queryFrequency: 3h
queryPeriod: 3h
triggerOperator: gt
triggerThreshold: 0
tactics:
- Impact
relevantTechniques:
- T1489
query: "let license_editions_lookup = _GetWatchlist(\"license_editions_lookup\");\
  \ \nlet license_types_lookup = _GetWatchlist(\"license_types_lookup\"); \nVeeam_GetSecurityEvents\n\
  | where instanceId == 24060\n| extend Edition = extract(\"Edition=\\\"([^\\\"]*)\\\
  \"\", 1, SyslogMessage)\n| lookup kind=leftouter (license_editions_lookup) \n  \
  \  on $left.Edition == $right.Edition\n| extend Type = extract(\"Type=\\\"([^\\\"\
  ]*)\\\"\", 1, SyslogMessage)\n| lookup kind=leftouter (license_types_lookup) \n\
  \    on $left.Type == $right.Type\n| extend TenantID = extract(\"TenantID=\\\"([^\\\
  \"]*)\\\"\", 1, SyslogMessage)\n| extend DaysLeft = extract(\"DaysLeft=\\\"([^\\\
  \"]*)\\\"\", 1, SyslogMessage)\n| extend SupportLeft = extract(\"SupportLeft=\\\"\
  ([^\\\"]*)\\\"\", 1, SyslogMessage)\n| project\n    Date = format_datetime(TimeGenerated,\
  \ 'dd.MM.yyyy HH:mm'),\n    DataSource = original_host,\n    EventId = instanceId,\n\
  \    [\"License Edition\"] = EditionDescription,\n    [\"License Type\"] = TypeDescription,\n\
  \    [\"Days Left\"] = DaysLeft,\n    [\"Days of Support Left\"] = SupportLeft,\n\
  \    MessageDetails = Description,\n    Severity = SeverityDescription"
version: 1.0.0
kind: Scheduled
customDetails:
  Date: Date
  VbrHostName: DataSource
  EventId: EventId
  MessageDetails: MessageDetails
  Severity: Severity
