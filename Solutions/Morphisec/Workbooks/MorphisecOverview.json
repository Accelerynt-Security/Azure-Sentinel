{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# Morphisec Security Overview\n---\n\nThis workbook provides comprehensive insights into Morphisec threat detection and prevention activities across your environment. Monitor security trends, investigate incidents, and track threat landscape changes."
      },
      "name": "text - header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "timerange-param",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 86400000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 300000
                },
                {
                  "durationMs": 900000
                },
                {
                  "durationMs": 1800000
                },
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            }
          }
        ],
        "style": "above",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - timerange"
    },
    {
      "type": 1,
      "content": {
        "json": "## Security Metrics Overview\n---"
      },
      "name": "text - metrics-header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| summarize TotalAlerts = count()",
        "size": 4,
        "title": "Total Alerts",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "card",
        "textSettings": {
          "style": "bignumber"
        }
      },
      "customWidth": "25",
      "name": "query - total-alerts"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| where LogSeverity in (\"10\", \"Critical\")\n| summarize CriticalAlerts = count()",
        "size": 4,
        "title": "Critical Alerts",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "card",
        "textSettings": {
          "style": "bignumber"
        }
      },
      "customWidth": "25",
      "name": "query - critical-alerts"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| extend DeviceName = coalesce(Computer, DeviceName)\n| summarize UniqueDevices = dcount(DeviceName)",
        "size": 4,
        "title": "Affected Devices",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "card",
        "textSettings": {
          "style": "bignumber"
        }
      },
      "customWidth": "25",
      "name": "query - affected-devices"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| extend ThreatName = coalesce(AttackName, Activity)\n| summarize UniqueThreatTypes = dcount(ThreatName)",
        "size": 4,
        "title": "Unique Threat Types",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "card",
        "textSettings": {
          "style": "bignumber"
        }
      },
      "customWidth": "25",
      "name": "query - unique-threats"
    },
    {
      "type": 1,
      "content": {
        "json": "## Threat Analysis\n---"
      },
      "name": "text - threat-analysis"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| extend ThreatCategory = coalesce(AttackCategory, \"Unknown\")\n| summarize AlertCount = count() by ThreatCategory\n| order by AlertCount desc",
        "size": 0,
        "title": "Threat Type Breakdown",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "piechart"
      },
      "customWidth": "50",
      "name": "query - threat-breakdown"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| extend SeverityLevel = case(\n    LogSeverity in (\"10\", \"Critical\"), \"Critical\",\n    LogSeverity in (\"8\", \"High\"), \"High\",\n    LogSeverity in (\"6\", \"Medium\"), \"Medium\",\n    LogSeverity in (\"4\", \"Low\"), \"Low\",\n    \"Unknown\"\n)\n| summarize AlertCount = count() by SeverityLevel\n| order by AlertCount desc",
        "size": 0,
        "title": "Severity Breakdown",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "piechart"
      },
      "customWidth": "50",
      "name": "query - severity-breakdown"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| extend ActionTaken = case(\n    Activity contains \"prevent\" or Activity contains \"block\", \"Prevented\",\n    Activity contains \"alert\" or Activity contains \"detect\", \"Alerted\",\n    \"Unknown\"\n)\n| summarize AlertCount = count() by ActionTaken\n| order by AlertCount desc",
        "size": 0,
        "title": "Alert vs Prevention Breakdown",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "piechart"
      },
      "customWidth": "50",
      "name": "query - action-breakdown"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| summarize AlertCount = count() by bin(TimeGenerated, {TimeRange:grain})\n| order by TimeGenerated asc",
        "size": 0,
        "title": "Alert Trends Over Time",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "areachart"
      },
      "customWidth": "50",
      "name": "query - alert-trends"
    },
    {
      "type": 1,
      "content": {
        "json": "## Top Targets Analysis\n---"
      },
      "name": "text - top-targets"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| extend DeviceName = coalesce(Computer, DeviceName)\n| summarize \n    AlertCount = count(),\n    CriticalAlerts = countif(LogSeverity in (\"10\", \"Critical\")),\n    HighAlerts = countif(LogSeverity in (\"8\", \"High\")),\n    UniqueThreatTypes = dcount(coalesce(AttackName, Activity)),\n    LatestAlert = max(TimeGenerated)\n    by DeviceName\n| order by AlertCount desc\n| limit 10",
        "size": 0,
        "title": "Top Hosts with Alerts",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "AlertCount",
              "formatter": 3,
              "formatOptions": {
                "palette": "redBright"
              }
            },
            {
              "columnMatch": "CriticalAlerts",
              "formatter": 3,
              "formatOptions": {
                "palette": "red"
              }
            },
            {
              "columnMatch": "HighAlerts",
              "formatter": 3,
              "formatOptions": {
                "palette": "orange"
              }
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "query - top-hosts"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| extend ProcessName = coalesce(ProcessName, extract(@\"([^\\\\]+)$\", 1, AttackedModule))\n| where isnotempty(ProcessName)\n| summarize \n    AlertCount = count(),\n    CriticalAlerts = countif(LogSeverity in (\"10\", \"Critical\")),\n    HighAlerts = countif(LogSeverity in (\"8\", \"High\")),\n    UniqueDevices = dcount(coalesce(Computer, DeviceName)),\n    LatestAlert = max(TimeGenerated)\n    by ProcessName\n| order by AlertCount desc\n| limit 10",
        "size": 0,
        "title": "Top Processes with Alerts",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "AlertCount",
              "formatter": 3,
              "formatOptions": {
                "palette": "redBright"
              }
            },
            {
              "columnMatch": "CriticalAlerts",
              "formatter": 3,
              "formatOptions": {
                "palette": "red"
              }
            },
            {
              "columnMatch": "HighAlerts",
              "formatter": 3,
              "formatOptions": {
                "palette": "orange"
              }
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "query - top-processes"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| extend UserName = coalesce(DestinationUserName, SourceUserName, \"System\")\n| where isnotempty(UserName)\n| summarize \n    AlertCount = count(),\n    CriticalAlerts = countif(LogSeverity in (\"10\", \"Critical\")),\n    HighAlerts = countif(LogSeverity in (\"8\", \"High\")),\n    UniqueDevices = dcount(coalesce(Computer, DeviceName)),\n    LatestAlert = max(TimeGenerated)\n    by UserName\n| order by AlertCount desc\n| limit 10",
        "size": 0,
        "title": "Top Users with Alerts",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "AlertCount",
              "formatter": 3,
              "formatOptions": {
                "palette": "redBright"
              }
            },
            {
              "columnMatch": "CriticalAlerts",
              "formatter": 3,
              "formatOptions": {
                "palette": "red"
              }
            },
            {
              "columnMatch": "HighAlerts",
              "formatter": 3,
              "formatOptions": {
                "palette": "orange"
              }
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "query - top-users"
    },
    {
      "type": 1,
      "content": {
        "json": "## High Severity Alerts Detail\n---"
      },
      "name": "text - high-severity"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| where LogSeverity in (\"10\", \"8\", \"Critical\", \"High\")\n| extend \n    DeviceName = coalesce(Computer, DeviceName),\n    ProcessName = coalesce(ProcessName, extract(@\"([^\\\\]+)$\", 1, AttackedModule)),\n    ThreatName = coalesce(AttackName, Activity),\n    ThreatCategory = AttackCategory,\n    UserName = coalesce(DestinationUserName, SourceUserName, \"System\"),\n    SeverityLevel = case(\n        LogSeverity in (\"10\", \"Critical\"), \"Critical\",\n        LogSeverity in (\"8\", \"High\"), \"High\",\n        \"Unknown\"\n    )\n| project \n    TimeGenerated,\n    SeverityLevel,\n    DeviceName,\n    UserName,\n    ProcessName,\n    ThreatName,\n    ThreatCategory,\n    Message = coalesce(Attackdescription, Message)\n| order by TimeGenerated desc",
        "size": 0,
        "title": "High Severity Alerts (Critical & High)",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "SeverityLevel",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "High",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "blue",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "TimeGenerated",
              "formatter": 6
            }
          ],
          "filter": true,
          "sortBy": [
            {
              "itemKey": "TimeGenerated",
              "sortOrder": 2
            }
          ]
        },
        "sortBy": [
          {
            "itemKey": "TimeGenerated",
            "sortOrder": 2
          }
        ]
      },
      "name": "query - high-severity-details"
    },
    {
      "type": 1,
      "content": {
        "json": "## Additional Insights\n---"
      },
      "name": "text - additional-insights"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| extend Hour = datetime_part('hour', TimeGenerated)\n| summarize AlertCount = count() by Hour\n| order by Hour asc",
        "size": 0,
        "title": "Alert Distribution by Hour of Day",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "columnchart"
      },
      "customWidth": "50",
      "name": "query - hourly-distribution"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "Morphisec\n| where TimeGenerated {TimeRange}\n| extend ThreatName = coalesce(AttackName, Activity)\n| where isnotempty(ThreatName)\n| summarize AlertCount = count() by ThreatName\n| order by AlertCount desc\n| limit 10",
        "size": 0,
        "title": "Top 10 Threat Types",
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "barchart"
      },
      "customWidth": "50",
      "name": "query - top-threat-types"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/{subscription-id}/resourceGroups/{resource-group}/providers/Microsoft.OperationalInsights/workspaces/{workspace-name}"
  ]
}
