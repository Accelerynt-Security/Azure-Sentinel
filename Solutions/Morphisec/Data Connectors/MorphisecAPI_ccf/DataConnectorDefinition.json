{
  "apiVersion": "2023-04-01-preview",
  "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
  "name": "MorphisecCCF",
  "location": "{{location}}",
  "kind": "Customizable",
  "properties": {
    "connectorUiConfig": {
      "id": "MorphisecCCF",
      "title": "Morphisec API Data Connector (via Codeless Connector Framework)",
      "publisher": "Morphisec",
      "descriptionMarkdown": "The [Morphisec Data Connector](https://www.morphisec.com/) allows ingesting logs from the Morphisec API into Microsoft Sentinel. This connector is built on the Microsoft Sentinel Codeless Connector Platform and uses the Morphisec API to fetch logs for Alerts, Detections, Hosts, Incidents, and Vulnerabilities. It supports DCR-based ingestion time transformations so that queries can run more efficiently.",
      "graphQueriesTableName": "MorphisecAlerts_CL",
      "graphQueries": [
        {
          "metricName": "Total Vulnerability logs received",
          "legend": "Morphisec Vulnerability Logs",
          "baseQuery": "{{graphQueriesTableName}}"
        }
      ],
      "sampleQueries": [
        {
          "description": "Get all Morphisec alerts",
          "query": "{{graphQueriesTableName}} | take 10"
        }
      ],
      "dataTypes": [
        {
          "name": "{{graphQueriesTableName}}",
          "lastDataReceivedQuery": "{{graphQueriesTableName}} | summarize Time = max(TimeGenerated) | where isnotempty(Time)"
        }
      ],
      "connectivityCriteria": [
        {
          "type": "HasDataConnectors"
        }
      ],
      "availability": {
        "isPreview": false
      },
      "permissions": {
        "resourceProvider": [
          {
            "provider": "Microsoft.OperationalInsights/workspaces",
            "permissionsDisplayText": "Read and Write permissions are required.",
            "providerDisplayName": "Workspace",
            "scope": "Workspace",
            "requiredPermissions": {
              "write": true,
              "read": true,
              "delete": true
            }
          }
        ]
      },
      "instructionSteps": [
        {
          "title": "Configure Morphisec Connector",
          "description": "1. Create an API key client in Morphisec Console with read permissions to fetch alerts. \n2. Provide the Client ID and Client Secret in the connector configuration.",
          "instructions": [
            {
              "type": "Textbox",
              "parameters": {
                "label": "Morphisec Base URL",
                "placeholder": "https://<your-morphisec-region>.morphisec.cloud",
                "type": "text",
                "name": "baseUrl"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Client ID",
                "placeholder": "Enter the Client ID",
                "type": "text",
                "name": "clientId"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Client Secret",
                "placeholder": "Enter the Client Secret",
                "type": "password",
                "name": "secret"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "Tenant ID",
                "placeholder": "Enter your Morphisec Tenant ID",
                "type": "text",
                "name": "tenantId"
              }
            },
            {
              "type": "ConnectionToggleButton",
              "parameters": {
                "connectLabel": "Connect to Morphisec",
                "name": "toggle"
              }
            }
          ]
        }
      ]
    }
  }
}