{
    "$schema": "https://schema.management.azure.com/schemas/2021-09-09/uiFormDefinition.schema.json",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "MongoDB Atlas Logs",
            "steps": [
                {
                    "name": "basics",
                    "label": "Basics",
                    "elements": [
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope",
                            "location": {
                            "metadata": {
                                "hidden": "Hiding location, we get it from the log analytics workspace"
                            },
                            "visible": false
                            }
                        },
                        {
                            "name": "useExistingWorkspace",
                            "type": "Microsoft.Common.OptionsGroup",
                            "label": "Use existing Log Analytics Workspace?",
                            "defaultValue": "yes",
                            "constraints": {
                            "allowedValues": [
                                {
                                    "label": "Yes",
                                    "value": "yes"
                                },
                                {
                                    "label": "No, create a new one",
                                    "value": "no"
                                }
                            ],
                            "required": true
                            },
                            "visible": true
                        },
                        {
                            "name": "LogAnalyticsWorkspaceResourceID",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Log Analytics Workspace Resource ID",
                            "subLabel": "",
                            "defaultValue": "/subscriptions/xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx/resourcegroups/xxxxxxxx/providers/microsoft.operationalinsights/workspaces/xxxxxxxx",
                            "toolTip": "Azure Resource ID (NOT THE WORKSPACE ID) of the existing Log Analytics Workspace where you would like the MongoDB Atlas data and optional Function App Application Insights data to reside. This can be found by clicking the &#34;JSON View&#34; link within the Overview page of the Log Analytics workspace resource. The format is: &#34;/subscriptions/xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx-xxxxxxxx/resourcegroups/xxxxxxxx/providers/microsoft.operationalinsights/workspaces/xxxxxxxx&#34;",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": "[equals(steps('basics').useExistingWorkspace, 'yes')]"
                        },
                        {
                            "name": "newWorkspaceName",
                            "type": "Microsoft.Common.TextBox",
                            "label": "New Workspace Name",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "Enter a name for the new Log Analytics workspace to be created.",
                            "constraints": {
                                "required": false,
                                "regex": "^[a-z0-9A-Z-]{4,63}$",
                                "validationMessage": "The name must be 4â€“63 characters long and contain only letters, numbers, and hyphens.",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": "[equals(steps('basics').useExistingWorkspace, 'no')]"
                        }
                    ]
                },
                {
                    "name": "mongodb",
                    "label": "MongoDB properties",
                    "elements": [
                        {
                            "name": "MongoDbGroupId",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Mongo Db Group Id",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The MongoDB Atlas Group Id to which you will connect.",
                            "constraints": {
                                "required": true,
                                "regex": "^([a-f0-9]{24})$",
                                "validationMessage": "Please enter a Group Id",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "MongoDbClusterId",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Mongo Db Cluster Id",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The MongoDB Atlas Cluster Id to which you will connect.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "regex": "^[a-zA-Z0-9][a-zA-Z0-9-.]*$",
                                "validationMessage": "Please enter a Cluster Id",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "MongoDbClientId",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Mongo Db Client Id",
                            "subLabel": "",
                            "defaultValue": "",
                            "toolTip": "The MongoDB Atlas client id which you can obtain from their portal.",
                            "constraints": {
                                "required": true,
                                "regex": "^[a-zA-Z0-9][a-zA-Z0-9-_]*$",
                                "validationMessage": "Please enter a Client Id",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        },
                        {
                            "name": "MongoDbClientSecret",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Enter Cluster Secret",
                            "defaultValue": "",
                            "toolTip": "The MongoDB Atlas client secret which you can obtain from their portal.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "Please enter a Client Secret",
                                "validations": []
                            },
                            "visible": true
                        },
                        {
                            "name": "categoryFilterList",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Enter list of categories to upload to Microsoft Sentinel",
                            "defaultValue": "ACCESS, NETWORK, QUERY",
                            "toolTip": "A list of categories for which the log entries will be uploaded to Microsoft Sentinel. At least one category is required.",
                            "constraints": {
                                "required": true,
                                "regex": "",
                                "validationMessage": "Please enter a Client Secret",
                                "validations": []
                            },
                            "visible": true
                        },
                        {
                            "name": "networkIdFilterList",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Enter a comma separated list of Network IDs to upload to Microsoft Sentinel, or leave blank to include all.",
                            "defaultValue": "",
                            "toolTip": "Comma separated list of Network IDs (Max 10) for which the log entries will be uploaded to Microsoft Sentinel. An empty list not filter out any log entries.",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "Enter a list of Network IDs or leave blank to not filter on Network ID",
                                "validations": []
                            },
                            "visible": true
                        }
                    ]
                },
                {
                    "name": "schedule",
                    "label": "Schedule",
                    "elements": [
                        {
                            "name": "schedule-text",
                            "type": "Microsoft.Common.TextBlock",
                            "options": {
                                "text": "The polling schedule at which logs will be uploaded from MongoDB Atlas into the Log Analytics workspace",
                                "link": {
                                    "label": "Learn more",
                                    "uri": "https://www.mongodb.com/docs/api/doc/atlas-admin-api-v2/"
                                }
                            }
                        },
                        {
                            "name": "ConnectorSchedule",
                            "type": "Microsoft.Common.TextBox",
                            "label": "Connector Schedule",
                            "subLabel": "",
                            "defaultValue": "0 */5 * * * *",
                            "toolTip": "The polling schedule at which logs will be uploaded from MongoDB Atlas into the Log Analytics workspace",
                            "constraints": {
                                "required": false,
                                "regex": "",
                                "validationMessage": "",
                                "validations": []
                            },
                            "infoMessages": [],
                            "visible": true
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "kind": "ResourceGroup",
            "location": "[steps('basics').resourceScope.location.name]",
            "resourceGroupId": "[steps('basics').resourceScope.resourceGroup.id]",
            "parameters": {
                "useExistingWorkspace": "[steps('basics').useExistingWorkspace]",
                "LogAnalyticsWorkspaceResourceID": "[steps('basics').LogAnalyticsWorkspaceResourceID]",
                "newWorkspaceName": "[steps('basics').newWorkspaceName]",
                "ConnectorSchedule": "[steps('schedule').ConnectorSchedule]",
                "MongoDbGroupId": "[steps('mongodb').MongoDbGroupId]",
                "MongoDbClusterId": "[steps('mongodb').MongoDbClusterId]",
                "MongoDbClientId": "[steps('mongodb').MongoDbClientId]",
                "MongoDbClientSecret": "[steps('mongodb').MongoDbClientSecret]",
                "categoryFilterList": "[steps('mongodb').categoryFilterList]",
                "networkIdFilterList": "[steps('mongodb').networkIdFilterList]"
            }
        }
    }
}