{
  "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
  "apiVersion": "2024-03-01-preview",
  "name": "[concat(parameters('workspace'), '/Microsoft.SecurityInsights/', 'RSAIDPlus_LockedAdminAccount_AnalyticRule')]",
  "location": "[parameters('workspace-location')]",
  "properties": {
    "contentId": "RSAIDPlus_LockedAdminAccount_AnalyticRule",
    "displayName": "RSA ID Plus - Locked Administrator Account Detected",
    "contentKind": "AnalyticsRule",
    "descriptionMarkdown": "Detects events where an RSA ID Plus administrator account has been locked. This may indicate multiple failed login attempts or account compromise.\n\n### Suggested Automation\nTo send an email alert when this rule triggers:\n1. Go to **Microsoft Sentinel → Automation → Create automation rule**.\n2. Set trigger: `When alert from this analytic rule fires`.\n3. Add an action → **Run playbook** → select **SendEmailOnRSAIDPlusAlert**.\n4. Customize recipients in the playbook if needed.",
    "mainTemplate": {
      "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
      "contentVersion": "1.0.0.0",
      "resources": [
        {
          "type": "Microsoft.SecurityInsights/alertRules",
          "apiVersion": "2024-03-01-preview",
          "name": "RSAIDPlus_LockedAdminAccount_Rule",
          "properties": {
            "displayName": "RSA ID Plus - Locked Administrator Account Detected",
            "enabled": true,
            "severity": "High",
            "tactics": ["CredentialAccess"],
            "techniques": ["T1110"],
            "query": "RSAIDPlus_AdminLogs_CL\n| where activityKey == 'LOCKED_ADMIN_ACCOUNT'\n| project TimeGenerated, customerName, adminUserName, adminUserRole, activityKey, sourceIPAddress",
            "queryFrequency": "PT5M",
            "queryPeriod": "PT5M",
            "triggerOperator": "GreaterThan",
            "triggerThreshold": 0,
            "customDetails": {
              "Customer_Name": "customerName",
              "Administrator": "adminUserName",
              "Administrator_Type": "adminUserRole",
              "Activity": "activityKey"
            },
            "entityMappings": [
              { "entityType": "IP", "fieldMappings": [ { "identifier": "Address", "columnName": "sourceIPAddress" } ] },
              { "entityType": "Account", "fieldMappings": [ { "identifier": "Name", "columnName": "adminUserName" } ] },
              { "entityType": "Host", "fieldMappings": [ { "identifier": "HostName", "columnName": "customerName" } ] }
            ],
            "alertDetailsOverride": {
              "alertDisplayNameFormat": "RSA ID Plus - Locked Administrator Account Detected: {{adminUserName}}",
              "alertDescriptionFormat": "Administrator {{adminUserName}} ({{adminUserRole}}) was locked in tenant {{customerName}}. Source IP: {{sourceIPAddress}}"
            },
            "incidentConfiguration": { "createIncident": true }
          }
        }
      ]
    }
  }
}