{
    "version": "Notebook/1.0",
    "items": [
      {
        "type": 1,
        "content": {
          "json": "## Posture History Workbook\n"
        },
        "name": "text - 2"
      },
      {
        "type": 9,
        "content": {
          "version": "KqlParameterItem/1.0",
          "parameters": [
            {
              "id": "a4422263-5b38-4e1b-96bf-010956675fe7",
              "version": "KqlParameterItem/1.0",
              "name": "bhe_tenant",
              "label": "BHE Tenant",
              "type": 2,
              "isRequired": true,
              "multiSelect": true,
              "quote": "'",
              "delimiter": ",",
              "query": "BloodHoundPostureHistory_CL\n| where isnotempty(tenant_url)\n| summarize arg_max(TimeGenerated, *) by tenant_url\n| extend display_name = replace_string(tenant_url, @\"https://\", \"\")\n| extend display_name = replace_string(display_name, @\"http://\", \"\")\n| extend display_name = replace_string(display_name, @\"/\", \"\") \n| project tenant_url, display_name",
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::1"
                ],
                "showDefault": false
              },
              "timeContext": {
                "durationMs": 86400000
              },
              "defaultValue": "value::1",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "value": [
                "value::1"
              ]
            },
            {
              "id": "627c2e6a-326c-479e-a0aa-9a5c0354c719",
              "version": "KqlParameterItem/1.0",
              "name": "domain_name",
              "label": "Domain",
              "type": 2,
              "isRequired": true,
              "query": "BloodHoundPostureHistory_CL\n| where isnotempty(domain_name)\n| where tenant_url in~ ({bhe_tenant})\n| distinct domain_name",
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::1"
                ]
              },
              "timeContext": {
                "durationMs": 86400000
              },
              "defaultValue": "value::1",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            }
          ],
          "style": "pills",
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces"
        },
        "name": "parameters - 2"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "BloodHoundPostureHistory_CL\n| where tenant_url in~ ({bhe_tenant})\n| where domain_name == '{domain_name}'\n| where data_type == \"findings\"\n| summarize avg(value) by bin(metric_date, 12h), domain_name, tenant_url\n| order by metric_date asc",
          "size": 1,
          "title": "Findings Trend Over Time",
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces",
          "visualization": "barchart"
        },
        "name": "Findings Trend Over Time"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "BloodHoundPostureHistory_CL\n| where tenant_url in~ ({bhe_tenant})\n| where domain_name == '{domain_name}'\n| where data_type == \"exposure\"\n| summarize avg(value) by bin(metric_date, 12h), domain_name, tenant_url\n| order by metric_date asc",
          "size": 0,
          "timeContext": {
            "durationMs": 86400000
          },
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces",
          "visualization": "barchart"
        },
        "name": "query - 3"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "BloodHoundPostureHistory_CL\n| where tenant_url in~ ({bhe_tenant})\n| where domain_name == '{domain_name}'\n| where data_type == \"assets\"\n| summarize avg(value) by bin(metric_date, 12h), domain_name, tenant_url\n| order by metric_date asc",
          "size": 0,
          "timeContext": {
            "durationMs": 86400000
          },
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces",
          "visualization": "barchart"
        },
        "name": "query - 4"
      }
    ],
    "fallbackResourceIds": [
      "/subscriptions/8487150a-2b54-4945-9a15-7aae2d005a3d/resourcegroups/specterops/providers/microsoft.operationalinsights/workspaces/specterops-log-analytics-workspace"
    ],
    "fromTemplateId": "sentinel-UserWorkbook",
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
  }
