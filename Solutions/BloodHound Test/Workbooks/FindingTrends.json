{
    "version": "Notebook/1.0",
    "items": [
      {
        "type": 9,
        "content": {
          "version": "KqlParameterItem/1.0",
          "parameters": [
            {
              "id": "b5affbc4-b123-4844-bab6-a352911dcd05",
              "version": "KqlParameterItem/1.0",
              "name": "bhe_tenant",
              "label": "BHE Tenant",
              "type": 2,
              "isRequired": true,
              "query": "BloodHoundFindingsTrendsDetails_CL \n| where isnotempty(tenant_url)\n| summarize arg_max(TimeGenerated, *) by tenant_url\n| extend display_name = replace_string(tenant_url, @\"https://\", \"\")\n| extend display_name = replace_string(display_name, @\"http://\", \"\")\n| extend display_name = replace_string(display_name, @\"/\", \"\") \n| project tenant_url, display_name",
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::1"
                ],
                "showDefault": false
              },
              "timeContext": {
                "durationMs": 86400000
              },
              "defaultValue": "value::1",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            {
              "id": "511679f9-e193-414d-9d06-c778e0372a69",
              "version": "KqlParameterItem/1.0",
              "name": "domain_name",
              "label": "Domain Name",
              "type": 2,
              "isRequired": true,
              "query": "BloodHoundFindingsTrendsDetails_CL\n| where isnotempty(domain_name)\n| where tenant_url == '{bhe_tenant}'\n| distinct domain_name",
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::1"
                ]
              },
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "value": "value::1"
            }
          ],
          "style": "pills",
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces"
        },
        "name": "parameters - 2"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "BloodHoundFindingsTrendsDetails_CL\n| where tenant_url == \"{bhe_tenant}\"\n| summarize MaxRisk = max(todouble(composite_risk)) by display_title\n| order by MaxRisk desc\n",
          "size": 2,
          "title": "Max Composite Risk per Display Title",
          "noDataMessageStyle": 2,
          "timeContext": {
            "durationMs": 43200000
          },
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces",
          "visualization": "categoricalbar",
          "tileSettings": {
            "showBorder": false
          },
          "graphSettings": {
            "type": 0
          },
          "chartSettings": {
            "createOtherGroup": 20,
            "showLegend": true
          },
          "mapSettings": {
            "locInfo": "LatLong",
            "sizeSettings": "TotalImpactCount",
            "sizeAggregation": "Sum",
            "legendMetric": "TotalImpactCount",
            "legendAggregation": "Sum",
            "itemColorSettings": {
              "type": "heatmap",
              "colorAggregation": "Sum",
              "nodeColorField": "TotalImpactCount",
              "heatmapPalette": "greenRed"
            }
          }
        },
        "name": "query - 3"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "BloodHoundFindingsTrendsDetails_CL\n| where tenant_url == \"https://maplesyrup.bloodhoundenterprise.io/\"\n| summarize \n    TotalImpact = sum(toint(impact_count)), \n    TotalExposure = sum(toint(exposure_count)), \n    MaxRisk = max(todouble(composite_risk))\n    by display_title",
          "size": 0,
          "title": "Impact vs. Exposure per Finding",
          "noDataMessageStyle": 4,
          "timeContext": {
            "durationMs": 86400000
          },
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces",
          "visualization": "table",
          "tileSettings": {
            "showBorder": false,
            "titleContent": {
              "columnMatch": "display_title",
              "formatter": 1
            },
            "leftContent": {
              "columnMatch": "TotalImpact",
              "formatter": 12,
              "formatOptions": {
                "palette": "auto"
              },
              "numberFormat": {
                "unit": 17,
                "options": {
                  "maximumSignificantDigits": 3,
                  "maximumFractionDigits": 2
                }
              }
            }
          },
          "graphSettings": {
            "type": 0,
            "topContent": {
              "columnMatch": "display_title",
              "formatter": 1
            },
            "centerContent": {
              "columnMatch": "TotalImpact",
              "formatter": 1,
              "numberFormat": {
                "unit": 17,
                "options": {
                  "maximumSignificantDigits": 3,
                  "maximumFractionDigits": 2
                }
              }
            }
          },
          "mapSettings": {
            "locInfo": "LatLong",
            "sizeSettings": "TotalImpact",
            "sizeAggregation": "Sum",
            "legendMetric": "TotalImpact",
            "legendAggregation": "Sum",
            "itemColorSettings": {
              "type": "heatmap",
              "colorAggregation": "Sum",
              "nodeColorField": "TotalImpact",
              "heatmapPalette": "greenRed"
            }
          }
        },
        "name": "query - 6"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "BloodHoundFindingsTrendsDetails_CL\n| where tenant_url == \"{bhe_tenant}\"\n| extend StartTime = todatetime(start_date), EndTime = todatetime(end_date)\n| mv-expand TimeBin = range(StartTime, EndTime, 1d)\n| extend TimeBin = todatetime(TimeBin)\n| summarize ActiveFindings = count() by TimeBin\n| order by TimeBin asc\n",
          "size": 0,
          "title": "Active Findings Timeline (per day)",
          "timeContext": {
            "durationMs": 86400000
          },
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces",
          "visualization": "table",
          "gridSettings": {
            "rowLimit": 10000
          }
        },
        "name": "query - 3"
      }
    ],
    "fallbackResourceIds": [
      "/subscriptions/8487150a-2b54-4945-9a15-7aae2d005a3d/resourcegroups/specterops/providers/microsoft.operationalinsights/workspaces/specterops-log-analytics-workspace"
    ],
    "fromTemplateId": "sentinel-UserWorkbook",
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
  }
