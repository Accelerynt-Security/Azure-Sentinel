{
    "version": "Notebook/1.0",
    "items": [
      {
        "type": 9,
        "content": {
          "version": "KqlParameterItem/1.0",
          "parameters": [
            {
              "id": "7b2610f8-46b2-4b21-ba57-3988c0b79e46",
              "version": "KqlParameterItem/1.0",
              "name": "bhe_tenant",
              "label": "BHE Tenant",
              "type": 2,
              "isRequired": true,
              "query": "BloodHoundPostureStats_CL\n| where isnotempty(tenant_url)\n| summarize arg_max(TimeGenerated, *) by tenant_url\n| extend display_name = replace_string(tenant_url, @\"https://\", \"\")\n| extend display_name = replace_string(display_name, @\"http://\", \"\")\n| extend display_name = replace_string(display_name, @\"/\", \"\") \n| project tenant_url, display_name\n",
              "typeSettings": {
                "additionalResourceOptions": [
                  "value::1"
                ],
                "showDefault": false
              },
              "timeContext": {
                "durationMs": 86400000
              },
              "defaultValue": "value::1",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            }
          ],
          "style": "pills",
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces"
        },
        "name": "parameters - 3"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "BloodHoundPostureStats_CL\n| where tenant_url == \"{bhe_tenant}\"\n| extend domain = domain_name\n| summarize arg_max(created_at, *) by id\n| extend exposure = round(todouble(exposure_index) * 100, 0)\n| extend created_at_dt = todatetime(created_at)\n| summarize max_exposure = max(exposure) by created_at_dt, domain\n| order by created_at_dt asc\n\n",
          "size": 1,
          "aggregation": 2,
          "title": "Domain Exposure",
          "timeContext": {
            "durationMs": 43200000
          },
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces",
          "visualization": "areachart",
          "tileSettings": {
            "showBorder": false,
            "titleContent": {
              "columnMatch": "domain",
              "formatter": 1
            },
            "leftContent": {
              "columnMatch": "max_exposure",
              "formatter": 12,
              "formatOptions": {
                "palette": "auto"
              },
              "numberFormat": {
                "unit": 17,
                "options": {
                  "maximumSignificantDigits": 3,
                  "maximumFractionDigits": 2
                }
              }
            }
          },
          "graphSettings": {
            "type": 0,
            "topContent": {
              "columnMatch": "domain",
              "formatter": 1
            },
            "centerContent": {
              "columnMatch": "max_exposure",
              "formatter": 1,
              "numberFormat": {
                "unit": 17,
                "options": {
                  "maximumSignificantDigits": 3,
                  "maximumFractionDigits": 2
                }
              }
            }
          },
          "chartSettings": {
            "xAxis": "created_at_dt",
            "yAxis": [
              "max_exposure"
            ],
            "group": "domain",
            "createOtherGroup": null,
            "showLegend": true
          }
        },
        "name": "query - 2"
      },
      {
        "type": 1,
        "content": {
          "json": "## Critical Attack Paths"
        },
        "name": "text - 6"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "BloodHoundPostureStats_CL\n| where tenant_url == \"{bhe_tenant}\"\n| extend domain = domain_name\n| summarize arg_max(created_at, *) by id\n| extend created_at_dt = todatetime(created_at)\n| summarize max_critical_risk_count = max(tolong(critical_risk_count)) by created_at_dt, domain\n| order by created_at_dt asc\n",
          "size": 1,
          "aggregation": 2,
          "title": "Critical Attack Paths",
          "timeContext": {
            "durationMs": 259200000
          },
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces",
          "visualization": "areachart",
          "tileSettings": {
            "showBorder": false,
            "titleContent": {
              "columnMatch": "domain",
              "formatter": 1
            },
            "leftContent": {
              "columnMatch": "max_critical_risk_count",
              "formatter": 12,
              "formatOptions": {
                "palette": "auto"
              },
              "numberFormat": {
                "unit": 17,
                "options": {
                  "maximumSignificantDigits": 3,
                  "maximumFractionDigits": 2
                }
              }
            }
          },
          "chartSettings": {
            "xAxis": "created_at_dt",
            "yAxis": [
              "max_critical_risk_count"
            ],
            "group": "domain",
            "createOtherGroup": null
          }
        },
        "name": "query - 2"
      },
      {
        "type": 3,
        "content": {
          "version": "KqlItem/1.0",
          "query": "BloodHoundPostureStats_CL\n| where tenant_url == \"{bhe_tenant}\"\n| extend domain = domain_name\n| summarize arg_max(created_at, *) by id\n| extend created_at_dt = todatetime(created_at)\n| summarize max_tier_zero_count = max(tolong(tier_zero_count)) by created_at_dt, domain\n| order by created_at_dt asc\n",
          "size": 0,
          "aggregation": 2,
          "title": "Tier Zero count",
          "timeContext": {
            "durationMs": 172800000
          },
          "queryType": 0,
          "resourceType": "microsoft.operationalinsights/workspaces",
          "visualization": "areachart"
        },
        "name": "query - 4"
      }
    ],
    "fallbackResourceIds": [
      "/subscriptions/8487150a-2b54-4945-9a15-7aae2d005a3d/resourcegroups/specterops/providers/microsoft.operationalinsights/workspaces/specterops-log-analytics-workspace"
    ],
    "fromTemplateId": "sentinel-UserWorkbook",
    "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
  }
