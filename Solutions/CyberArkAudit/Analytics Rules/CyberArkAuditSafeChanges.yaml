kind: Scheduled
name: CyberArk - Sensitive Safe/Permission Changes
description: >
  Alerts when changes related to safes, permissions, ACLs, owners, or roles are observed
  (control-plane modifications that impact who can access what).
severity: High
tactics:
  - PrivilegeEscalation
queryFrequency: PT10M
queryPeriod: P1D
triggerOperator: GreaterThan
triggerThreshold: 0
query: |
  let indicators = dynamic(["SafeMember","Permission","Access","ACL","Owner","Role"]);
  CyberArk_AuditEvents_CL
  | extend EventTime = datetime(1970-01-01) + tolong(timestamp)*1s
  | where action has_any (indicators)
      or actionType has_any (indicators)
      or auditType has_any (indicators)
      or message has_any (indicators)
  | project EventTime, CyberArkTenantId, username, userId, safe, action, actionType, auditType, target, message
entityMappings:
  - entityType: Account
    fieldMappings:
      - identifier: FullName
        columnName: username
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: target
suppressionEnabled: false
version: 1.0.0
